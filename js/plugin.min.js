function wowbraryShortcodePlugin(a,b){function c(){var b={},c=a.selection.getNode();if(tinymce.DOM.hasClass(c,"wowbraryShortcodeGUI"))for(var d,e=JSON.parse(tinymce.DOM.getAttrib(c,"data-wowbrary","")),f=/([A-Za-z0-9_]+)\s*=(\s*"([^"\]]*)"|'([^"\]]*)'|([^\]\s]+))/g;null!==(d=f.exec(e));)b[d[1]]=d[3]||d[4]||d[5];var g=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onSubmit:function(){for(var b="[wowbrary",c=g.find("*"),d=0;d<c.length;d++)c[d].name()&&c[d].value()&&(b+=" "+c[d].name()+"=",b+='"'+c[d].value()+'"');b+="]",a.insertContent(b)},items:{type:"form",padding:20,labelGap:30,spacing:10,onPostRender:function(){this.find("[name]").each(function(a){a.name()in b&&a.value(b[a.name()])})},items:[{type:"textbox",name:"height",size:40,label:"Height"},{type:"textbox",name:"count",size:40,label:"Max Count"},{type:"listbox",name:"motion",label:"Motion",values:[{text:"One at a time",value:"one-at-a-time"},{text:"Continuous",value:"continuous"},{text:"All at once",value:"all-at-once"},{text:"Morph",value:"morph"}]},{type:"checkbox",name:"noelectronic",text:"Block electronic?",label:" "},{type:"listbox",name:"category",label:"Category",values:[{value:"GEN",text:"Top Choices"},{value:"ART",text:"Arts & Photography"},{value:"BIO",text:"Biographies & Memoirs"},{value:"BUS",text:"Business & Investing"},{value:"CDS",text:"CDs: Music & Shows"},{value:"CHI",text:"Business & Investing"},{value:"CGR",text:"Comics & Graphic Novels"},{value:"COM",text:"Computers & Internet"},{value:"COO",text:"Cooking, Food & Wine"},{value:"DVD",text:"DVDs"},{value:"EBO",text:"eBooks & eAudios"},{value:"ENT",text:"Entertainment"},{value:"HEA",text:"Health, Mind & Body"},{value:"HIS",text:"History"},{value:"HOM",text:"Home & Garden"},{value:"LRG",text:"Large Print"},{value:"LIT",text:"Literature & Fiction"},{value:"MYS",text:"Mysteries & Thrillers"},{value:"NEN",text:"Non-English"},{value:"OUT",text:"Outdoors & Nature"},{value:"PAR",text:"Parenting & Family"},{value:"PRO",text:"Professional & Technical"},{value:"REF",text:"Reference"},{value:"REL",text:"Religion & Spirituality"},{value:"ROM",text:"Romance"},{value:"SCI",text:"Science"},{value:"SFF",text:"Science Fiction & Fantasy"},{value:"SOC",text:"Society"},{value:"SPO",text:"Sports"},{value:"TEE",text:"Teen"},{value:"TRA",text:"Travel"}]},{type:"button",name:"submit",text:"submit",onclick:function(){g.submit()}}]}}).renderTo().reflow()}var d=this;a.contentCSS.push(b+"/plugin-style.css"),a.addCommand("Wowbrary",c),a.addButton("Wowbrary",{text:"Wowbrary",tooltip:"Add/Edit Wowbrary content...",icon:!1,cmd:"Wowbrary",stateSelector:"div.wowbraryShortcodeGUI"}),a.on("BeforeSetContent",function(a){a.content=d._do_wowbrary_shortcode(a.content)}),a.on("ExecCommand",function(a){"mceInsertContent"===a.command&&tinymce.activeEditor.setContent(d._do_wowbrary_shortcode(tinymce.activeEditor.getContent()))}),a.on("PostProcess",function(a){console.log(a),(a.save||a.source_view)&&(console.log("replacing"),a.content=d._undo_wowbrary_shortcode(a.content),console.log(a.content))}),d._do_wowbrary_shortcode=function(a){return a.replace(/\[wowbrary([^\]]*)\]/g,function(b,c,d){var e=tinymce.DOM.encode(JSON.stringify("wowbrary "+c)),f="";return 0===d&&(f+="<p>&nbsp;</p>"),f+='<div class="wowbraryShortcodeGUI mceNonEditable mceItem" ',f+='data-wowbrary="'+e+'">',f+="<h2>Wowbrary</h2>",f+="wowbrary "+c,f+="</div>",d+b.length>=a.length&&(f+="<p>&nbsp;</p>"),f})},d._undo_wowbrary_shortcode=function(a){var b=new tinymce.html.Writer,c={depth:0,ignoring:!1};return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!1,comment:function(a){c.ignoring||b.comment(a)},cdata:function(a){c.ignoring||b.cdata(a)},text:function(a,d){c.ignoring||b.text(a,d)},start:function(a,d,e){for(var f=0;f<d.length;f++)if("data-wowbrary"==d[f].name){c.ignoring=!0,b.text("["+JSON.parse(d[f].value)+"]");break}return c.ignoring?void(c.depth+=1):void b.start(a,d,e)},end:function(a){return c.ignoring?(c.depth+=-1,void(0===c.depth&&(c.ignoring=!1))):void b.end(a)}},new tinymce.html.Schema({})).parse(a),b.getContent()}}tinymce.PluginManager.add("wowbrary_shortcode",wowbraryShortcodePlugin,["noneditable"]);